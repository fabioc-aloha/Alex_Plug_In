# yaml-language-server: $schema=https://aka.ms/teams-toolkit/v1.8/yaml.schema.json
# Local development configuration

version: v1.8

provision:
  # Creates a Teams app for local development
  - uses: teamsApp/create
    with:
      name: Alex Cognitive-local
    writeToEnvironmentFile:
      teamsAppId: TEAMS_APP_ID

  # Register API key for local development
  - uses: apiKey/register
    with:
      name: alex-knowledge-api-key-local
      appId: ${{TEAMS_APP_ID}}
      apiSpecPath: ./appPackage/openapi.yaml
    writeToEnvironmentFile:
      registrationId: ALEX_API_KEY_REGISTRATION_ID

  # Build Teams app package
  - uses: teamsApp/zipAppPackage
    with:
      manifestPath: ./appPackage/manifest.json
      outputZipPath: ./appPackage/build/appPackage.local.zip
      outputFolder: ./appPackage/build

  # Validate manifest
  - uses: teamsApp/validateManifest
    with:
      manifestPath: ./appPackage/build/manifest.local.json

  # Update Teams app
  - uses: teamsApp/update
    with:
      appPackagePath: ./appPackage/build/appPackage.local.zip

deploy:
  # For local development, API runs on localhost
  # Start with: npm run start:api
  - uses: script
    with:
      run: echo "Start local API with 'npm run start:api'"
