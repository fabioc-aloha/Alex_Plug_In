openapi: 3.0.3
info:
  title: Alex Knowledge API
  description: |
    API for accessing Alex Cognitive Architecture's knowledge base.
    Provides endpoints for searching patterns, retrieving insights,
    accessing user profiles, notes, and learning goals.
  version: 1.0.0
  contact:
    name: Alex Cognitive Architecture
    url: https://github.com/fabiocarvalho/alex-cognitive-architecture

servers:
  - url: ${{AZURE_FUNCTIONS_URL}}/api
    description: Azure Functions API

paths:
  /searchKnowledge:
    get:
      operationId: searchKnowledge
      summary: Search the global knowledge base
      description: |
        Search for patterns, domain knowledge, and insights from the user's
        cross-project knowledge base. Returns relevant GK-* and DK-* files.
      parameters:
        - name: query
          in: query
          required: true
          description: Search query for finding relevant knowledge
          schema:
            type: string
            minLength: 1
            maxLength: 500
        - name: category
          in: query
          required: false
          description: Filter by category
          schema:
            type: string
            enum:
              - error-handling
              - api-design
              - testing
              - debugging
              - performance
              - architecture
              - security
              - deployment
              - patterns
              - general
        - name: limit
          in: query
          required: false
          description: Maximum number of results
          schema:
            type: integer
            minimum: 1
            maximum: 20
            default: 5
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: object
                properties:
                  results:
                    type: array
                    items:
                      type: object
                      properties:
                        title:
                          type: string
                          description: Title of the knowledge item
                        category:
                          type: string
                          description: Category of the knowledge
                        content:
                          type: string
                          description: Relevant excerpt from the knowledge
                        source:
                          type: string
                          description: Source file reference
                        relevance:
                          type: number
                          description: Relevance score 0-1
                  totalCount:
                    type: integer
                    description: Total matching results

  /getInsights:
    get:
      operationId: getInsights
      summary: Get recent insights
      description: |
        Retrieve timestamped insights (GI-*) captured during meditation
        sessions and learning activities across all projects.
      parameters:
        - name: days
          in: query
          required: false
          description: Number of days to look back
          schema:
            type: integer
            minimum: 1
            maximum: 90
            default: 30
        - name: project
          in: query
          required: false
          description: Filter by project name
          schema:
            type: string
        - name: limit
          in: query
          required: false
          description: Maximum number of insights
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
      responses:
        '200':
          description: List of insights
          content:
            application/json:
              schema:
                type: object
                properties:
                  insights:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        title:
                          type: string
                        content:
                          type: string
                        date:
                          type: string
                          format: date-time
                        project:
                          type: string
                        tags:
                          type: array
                          items:
                            type: string

  /getProfile:
    get:
      operationId: getProfile
      summary: Get user profile
      description: |
        Retrieve the user's profile including preferences, expertise,
        and communication style settings.
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema:
                type: object
                properties:
                  profile:
                    type: object
                    properties:
                      name:
                        type: string
                      nickname:
                        type: string
                      formality:
                        type: string
                        enum: [casual, balanced, formal]
                      detailLevel:
                        type: string
                        enum: [brief, balanced, detailed]
                      primaryTechnologies:
                        type: array
                        items:
                          type: string
                      learningGoals:
                        type: array
                        items:
                          type: string
                      expertiseAreas:
                        type: array
                        items:
                          type: string
                      currentProjects:
                        type: array
                        items:
                          type: string

  /getNotes:
    get:
      operationId: getNotes
      summary: Get notes and reminders
      description: |
        Access user notes, reminders, and Alex's observations.
        Can filter by type and status.
      parameters:
        - name: type
          in: query
          required: false
          description: Filter by note type
          schema:
            type: string
            enum: [reminder, note, observation, all]
            default: all
        - name: status
          in: query
          required: false
          description: Filter by status
          schema:
            type: string
            enum: [active, completed, snoozed, all]
            default: active
        - name: project
          in: query
          required: false
          description: Filter by project scope
          schema:
            type: string
      responses:
        '200':
          description: List of notes
          content:
            application/json:
              schema:
                type: object
                properties:
                  notes:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        type:
                          type: string
                          enum: [reminder, note, observation]
                        content:
                          type: string
                        created:
                          type: string
                          format: date-time
                        status:
                          type: string
                        triggers:
                          type: object
                          properties:
                            date:
                              type: string
                              format: date-time
                            keywords:
                              type: array
                              items:
                                type: string
                            project:
                              type: string

  /getLearningGoals:
    get:
      operationId: getLearningGoals
      summary: Get learning goals and progress
      description: |
        Retrieve the user's learning goals from their profile along with
        tracked progress on skills they're developing.
      responses:
        '200':
          description: Learning goals and progress
          content:
            application/json:
              schema:
                type: object
                properties:
                  goals:
                    type: array
                    description: User's stated learning goals
                    items:
                      type: object
                      properties:
                        topic:
                          type: string
                          description: The skill or topic
                        status:
                          type: string
                          enum: [active, achieved, paused]
                        progress:
                          type: string
                          description: Progress notes
                        relatedPatterns:
                          type: array
                          description: Related GK/DK files
                          items:
                            type: string
                  recentTopics:
                    type: array
                    description: Topics practiced in recent sessions
                    items:
                      type: object
                      properties:
                        topic:
                          type: string
                        sessionCount:
                          type: integer
                          description: Number of sessions practicing this
                        lastPracticed:
                          type: string
                          format: date
                        suggestConsolidation:
                          type: boolean
                          description: Whether to suggest creating a DK file

  # ============================================================================
  # PROACTIVE MEMORY SYSTEM - Write Operations
  # ============================================================================

  /addReminder:
    post:
      operationId: addReminder
      summary: Create a new reminder
      description: |
        Add a reminder with optional triggers. Reminders can be triggered by:
        - Specific date/time
        - Keywords mentioned in conversation
        - Project context
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - content
              properties:
                content:
                  type: string
                  description: The reminder text
                triggerDate:
                  type: string
                  format: date-time
                  description: When to trigger the reminder
                keywords:
                  type: array
                  items:
                    type: string
                  description: Keywords that trigger the reminder
                project:
                  type: string
                  description: Project scope for the reminder
      responses:
        '201':
          description: Reminder created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  reminder:
                    type: object
                    properties:
                      id:
                        type: string
                      content:
                        type: string
                      created:
                        type: string
                        format: date-time

  /addNote:
    post:
      operationId: addNote
      summary: Save a note or observation
      description: |
        Store persistent notes that Alex remembers across sessions.
        - Notes: User-provided context ("remember that...")
        - Observations: Alex's own observations about patterns
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - content
              properties:
                content:
                  type: string
                  description: The note content
                type:
                  type: string
                  enum: [note, observation]
                  default: note
                project:
                  type: string
                  description: Optional project scope
                tags:
                  type: array
                  items:
                    type: string
                  description: Tags for categorization
      responses:
        '201':
          description: Note created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  note:
                    type: object

  /updateReminder:
    post:
      operationId: updateReminder
      summary: Update a reminder status
      description: |
        Mark a reminder as completed, snoozed, reactivated, or delete it.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
                - action
              properties:
                id:
                  type: string
                  description: The reminder ID
                action:
                  type: string
                  enum: [complete, snooze, reactivate, delete]
                  description: Action to perform
      responses:
        '200':
          description: Reminder updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean

  /getDueReminders:
    get:
      operationId: getDueReminders
      summary: Get due reminders for proactive surfacing
      description: |
        Returns reminders that should be surfaced based on current context.
        Checks date triggers, keyword matches, and project context.
      parameters:
        - name: keywords
          in: query
          required: false
          description: Comma-separated keywords to check against triggers
          schema:
            type: string
        - name: project
          in: query
          required: false
          description: Current project context
          schema:
            type: string
      responses:
        '200':
          description: Due reminders
          content:
            application/json:
              schema:
                type: object
                properties:
                  reminders:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        content:
                          type: string
                        triggers:
                          type: object
                  count:
                    type: integer

  # ============================================================================
  # TIME AWARENESS - Session Tracking
  # ============================================================================

  /getSessionStatus:
    get:
      operationId: getSessionStatus
      summary: Get current session status and time-based suggestions
      description: |
        Returns the current work session status including duration and
        gentle suggestions for breaks or meditation. Respects user preferences.
      responses:
        '200':
          description: Session status
          content:
            application/json:
              schema:
                type: object
                properties:
                  active:
                    type: boolean
                    description: Whether a session is currently active
                  durationMinutes:
                    type: integer
                    description: How long the current session has been running
                  session:
                    type: object
                    properties:
                      id:
                        type: string
                      startTime:
                        type: string
                        format: date-time
                      topic:
                        type: string
                      project:
                        type: string
                      breaksTaken:
                        type: integer
                  suggestion:
                    type: object
                    description: Time-based suggestion (if applicable)
                    properties:
                      type:
                        type: string
                        enum: [break, meditate, wrap-up]
                      message:
                        type: string
                  preferences:
                    type: object
                    properties:
                      breakReminderMinutes:
                        type: integer
                        default: 90
                      enableTimeTracking:
                        type: boolean
                        default: true

  /startSession:
    post:
      operationId: startSession
      summary: Start or resume a work session
      description: |
        Begins tracking a work session for time awareness features.
        If a session already exists, updates its last activity time.
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                topic:
                  type: string
                  description: What you're working on
                project:
                  type: string
                  description: Project context
      responses:
        '200':
          description: Session started or resumed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  session:
                    type: object

  /sessionAction:
    post:
      operationId: sessionAction
      summary: Perform session action (end, break, check-in)
      description: |
        Actions for managing the current session:
        - end: End the session and get summary
        - break: Record a break taken
        - checkin: Acknowledge a suggestion was shown
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - action
              properties:
                action:
                  type: string
                  enum: [end, break, checkin]
                breakMinutes:
                  type: integer
                  description: Duration of break (for break action)
      responses:
        '200':
          description: Action completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  summary:
                    type: object
                    description: Session summary (for end action)
                    properties:
                      totalMinutes:
                        type: integer
                      focusMinutes:
                        type: integer
                      breaks:
                        type: integer

components:
  securitySchemes:
    apiKey:
      type: apiKey
      in: header
      name: X-Alex-API-Key

security:
  - apiKey: []
